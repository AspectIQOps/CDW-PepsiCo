services:
  etl-analytics:
    build:
      context: .
      dockerfile: docker/etl/Dockerfile
    container_name: pepsico-etl-analytics
    environment:
      # AWS Configuration
      - AWS_REGION=us-east-2
      - AWS_DEFAULT_REGION=us-east-2
      
      # Database connection will be fetched from SSM by entrypoint.sh
      # SSM Parameter paths
      - SSM_PREFIX=/pepsico
      - SSM_APPDYNAMICS_PREFIX=/pepsico/appdynamics
      - SSM_SERVICENOW_PREFIX=/pepsico/servicenow
      
      # Pipeline configuration
      - PIPELINE_MODE=${PIPELINE_MODE:-full}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DRY_RUN=${DRY_RUN:-false}
      
    volumes:
      - ./scripts:/app/scripts
      - ./sql:/app/sql
      - ./logs:/app/logs
      - ~/.aws:/root/.aws:ro  # Mount AWS credentials for SSM access
    
    entrypoint: ["/app/docker/etl/entrypoint.sh"]
    
    command: python3 /app/scripts/etl/run_pipeline.py
    
    restart: "no"
    
    networks:
      - analytics-network

networks:
  analytics-network:
    driver: bridge